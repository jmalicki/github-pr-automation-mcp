{
  "id": 2471424841,
  "type": "review_comment",
  "author": "coderabbitai[bot]",
  "author_association": "CONTRIBUTOR",
  "is_bot": true,
  "created_at": "2025-10-29T00:26:31Z",
  "updated_at": "2025-10-29T00:26:32Z",
  "file_path": "scripts/pre-push-version-check.js",
  "line_number": 47,
  "start_line": 42,
  "diff_hunk": [
    "@@ -0,0 +1,92 @@",
    "+#!/usr/bin/env node",
    "+",
    "+/**",
    "+ * Pre-push hook to validate version tags",
    "+ * Ensures package.json and CHANGELOG.md are updated when pushing version tags",
    "+ */",
    "+",
    "+/* eslint-env node */",
    "+",
    "+import { existsSync } from 'fs';",
    "+import { execSync } from 'child_process';",
    "+import { fileURLToPath } from 'url';",
    "+import { dirname, join } from 'path';",
    "+",
    "+const __filename = fileURLToPath(import.meta.url);",
    "+const __dirname = dirname(__filename);",
    "+const rootDir = join(__dirname, '..');",
    "+",
    "+// Version tag pattern (e.g., v1.2.3, v1.2.3-alpha.1)",
    "+const VERSION_TAG_PATTERN = /^v\\d+\\.\\d+\\.\\d+(-[a-zA-Z0-9.-]+)?$/;",
    "+",
    "+function checkVersionTagValidation() {",
    "+  console.log('üîç Checking for version tags...');",
    "+  ",
    "+  try {",
    "+    // Check if we're pushing any version tags",
    "+    const remote = process.argv[2] || 'origin';",
    "+    const refs = process.argv[3] || 'main';",
    "+    ",
    "+    // Get the refs being pushed",
    "+    execSync(`git ls-remote --heads --tags ${remote} ${refs}`, { ",
    "+      encoding: 'utf8',",
    "+      cwd: rootDir ",
    "+    });",
    "+    ",
    "+    // For simplicity, check if any local tags match version pattern",
    "+    const localTags = execSync('git tag -l', { ",
    "+      encoding: 'utf8',",
    "+      cwd: rootDir ",
    "+    }).trim().split('\\n').filter(Boolean);",
    "+    ",
    "+    const versionTags = localTags.filter(tag => VERSION_TAG_PATTERN.test(tag));",
    "+    ",
    "+    if (versionTags.length === 0) {",
    "+      console.log('‚úÖ No version tags detected, skipping validation');",
    "+      return true;",
    "+    }"
  ],
  "body": [
    "_‚ö†Ô∏è Potential issue_ | _üü† Major_",
    "",
    "**Logic doesn't validate tags being pushed.**",
    "",
    "The current logic checks if ANY local version tags exist, then validates package.json and CHANGELOG.md. This means even if you're not pushing a version tag, the validation will still run if you have any local version tags.",
    "",
    "",
    "",
    "The hook should only validate when version tags are actually being pushed, not just when they exist locally. This requires reading the refs being pushed from the hook's stdin (see comment on lines 27-34).",
    "",
    "<details>",
    "<summary>ü§ñ Prompt for AI Agents</summary>",
    "",
    "```",
    "In scripts/pre-push-version-check.js around lines 42 to 47, the code currently",
    "checks for any local version tags and runs validation, but it must only validate",
    "when version tags are actually being pushed; update the logic to read the refs",
    "being pushed from the hook's stdin (parse the stdin lines or read file",
    "descriptor 0), extract the ref names from those lines, filter those refs with",
    "VERSION_TAG_PATTERN to detect pushed version tags, and only run",
    "package.json/CHANGELOG.md validation if that filtered pushed-tags list is",
    "non-empty; leave existing VERSION_TAG_PATTERN usage and validation steps",
    "unchanged, just replace the localTags check with a check against the pushed refs",
    "parsed from stdin.",
    "```",
    "",
    "</details>",
    "",
    "<!-- This is an auto-generated comment by CodeRabbit -->"
  ],
  "outdated": false,
  "reactions": {
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "html_url": "https://github.com/jmalicki/github-pr-automation-mcp/pull/65#discussion_r2471424841",
  "action_commands": {
    "reply_command": "gh api -X POST /repos/jmalicki/github-pr-automation-mcp/pulls/65/comments/2471424841/replies -f body=\"YOUR_RESPONSE_HERE\"",
    "resolve_command": "gh api -X POST /repos/jmalicki/github-pr-automation-mcp/pulls/65/comments/2471424841/replies -f body=\"‚úÖ Fixed\"",
    "resolve_condition": "Run ONLY after you've verified the fix for: \"_‚ö†Ô∏è Potential issue_ | _üü† Major_...\"",
    "view_in_browser": "gh pr view 65 --repo jmalicki/github-pr-automation-mcp --web",
    "mcp_action": {
      "tool": "resolve_review_thread",
      "args": {
        "pr": "jmalicki/github-pr-automation-mcp#65",
        "thread_id": "PRRT_kwDOQG2ass5fsPvM"
      }
    }
  },
  "status_indicators": {
    "needs_mcp_resolution": true,
    "has_manual_response": false,
    "is_actionable": true,
    "is_outdated": false,
    "priority_score": 35,
    "resolution_status": "in_progress",
    "suggested_action": "resolve"
  }
}
